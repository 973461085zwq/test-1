language: dart
dart:
  - stable
  - dev

# Trusty is necessary to install Chrome.
dist: trusty
sudo: true

# Install Chrome
addons:
  apt:
    sources:
      - google-chrome
      - sourceline: deb http://gce_debian_mirror.storage.googleapis.com precise contrib non-free
      - sourceline: deb http://gce_debian_mirror.storage.googleapis.com precise-updates contrib non-free
      - sourceline: deb http://us.archive.ubuntu.com/ubuntu/ trusty multiverse
      - sourceline: deb http://us.archive.ubuntu.com/ubuntu/ trusty-updates multiverse
    packages:
      - google-chrome-stable

before_install:
  # Install Content Shell
  - sudo sh -c 'echo ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true | debconf-set-selections'
  - sudo sh -c 'apt-get install --no-install-recommends -y -q chromium-browser libudev1 ttf-kochi-gothic ttf-kochi-mincho ttf-mscorefonts-installer ttf-indic-fonts ttf-dejavu-core ttf-indic-fonts-core fonts-thai-tlwg msttcorefonts xvfb'
  - wget https://storage.googleapis.com/dart-archive/channels/stable/release/latest/dartium/content_shell-linux-x64-release.zip
  - unzip content_shell-linux-x64-release.zip
  - rm content_shell-linux-x64-release.zip
  - export PATH="${PWD%/}/$(echo drt-*-full-stable-*):$PATH"

  # Give browsers a display to run against.
  - echo $DISPLAY
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start

  # Install Dartium
  - wget https://storage.googleapis.com/dart-archive/channels/stable/release/latest/dartium/dartium-linux-x64-release.zip
  - unzip dartium-linux-x64-release.zip
  - rm dartium-linux-x64-release.zip
  - mv `echo dartium-*-full-stable-*`/{chrome,dartium}
  - export PATH="${PWD%/}/$(echo dartium-*-full-stable-*):$PATH"
